#!/bin/bash

# Verificar que el usuario sea root
if [ "$EUID" -ne 0 ]; then
    echo "âŒ Este script debe ejecutarse como root o con sudo."
    exit 1
fi

# Verificar la versiÃ³n de Ubuntu
UBUNTU_VERSION=$(lsb_release -r | awk '{print $2}')
if [ "$UBUNTU_VERSION" != "22.04" ]; then
    echo "âŒ Este script solo se ejecuta en Ubuntu 22.04. Su versiÃ³n es $UBUNTU_VERSION"
    exit 1
fi

echo "âœ… VersiÃ³n de Ubuntu validada: $UBUNTU_VERSION"
echo "ğŸ”„ Actualizando paquetes..."
apt update -y && apt upgrade -y

# Instalar Apache
echo "ğŸ”§ Instalando Apache..."
apt install -y apache2
systemctl enable apache2
systemctl start apache2
echo "âœ… Apache instalado y en ejecuciÃ³n."

# Instalar Node.js y npm
echo "ğŸ”§ Instalando Node.js y npm..."
curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
apt install -y nodejs
echo "âœ… Node.js y npm instalados."
echo "ğŸ“Œ VersiÃ³n instalada de Node.js: $(node -v)"
echo "ğŸ“Œ VersiÃ³n instalada de npm: $(npm -v)"

# Instalar MySQL Server
echo "ğŸ”§ Instalando MySQL Server..."
apt install -y mysql-server
systemctl enable mysql
systemctl start mysql

# Configurar MySQL root password (se puede personalizar)
MYSQL_ROOT_PASSWORD="SecurePass123!"
echo "ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '${MYSQL_ROOT_PASSWORD}'; FLUSH PRIVILEGES;" | mysql -u root
echo "âœ… MySQL instalado y configurado."
echo "ğŸ“Œ Recuerda cambiar la contraseÃ±a por una segura: $MYSQL_ROOT_PASSWORD"

# Instalar React (Create React App)
echo "ğŸ”§ Instalando Create-React-App..."
npm install -g create-react-app
echo "âœ… Create-React-App instalado."

# VerificaciÃ³n final
echo "ğŸ” Validando instalaciones..."
echo "ğŸŒ Apache: $(apache2 -v | grep 'Server version')"
echo "ğŸ›  Node.js: $(node -v)"
echo "ğŸ“¦ npm: $(npm -v)"
echo "âš›ï¸ React: $(create-react-app --version)"
echo "ğŸ—„ï¸ MySQL: $(mysql --version)"

echo "ğŸ‰ InstalaciÃ³n completada con Ã©xito. Â¡Tu entorno estÃ¡ listo!"
